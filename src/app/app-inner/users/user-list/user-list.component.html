<mat-card class="no-color with-search page-main-card">
  <mat-card-header>
    <mat-card-title class="main-title">Users
    </mat-card-title>
    <div fxFlex></div>
    <div class="compact-form-control">

      <button mat-icon-button color="accent" (click)="userList.reload()">
        <mat-icon matSuffix>sync</mat-icon>
      </button>&nbsp;

      <mat-form-field appearance="standard" class="main-search-bar">
        <mat-label>Search</mat-label>
        <input matInput [(ngModel)]="userList.filter.search" (keyup)="userList.getList(1)">
        <mat-icon matSuffix color="primary">search</mat-icon>
      </mat-form-field>
    </div>
  </mat-card-header>
  <div class="ts-clearfix"></div>
  <mat-card-content>
    <div fxFlex class="width-100">
      <mat-progress-bar [mode]="(userList._isDataLoading) ? 'query' : 'determinate'"></mat-progress-bar>
      <div class="table-responsive">
        <table *ngIf="userList.canShowTable()" mat-table [dataSource]="userList.data"
               class="mat-elevation-z8 width-100 no-table-cell-wrap">

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef> Email</th>
            <td mat-cell *matCellDef="let item"> {{item.email}} </td>
          </ng-container>
          <ng-container matColumnDef="first_name">
            <th mat-header-cell *matHeaderCellDef> First Name</th>
            <td mat-cell *matCellDef="let item"> {{item.first_name}} </td>
          </ng-container>
          <ng-container matColumnDef="phone">
            <th mat-header-cell *matHeaderCellDef> Phone</th>
            <td mat-cell *matCellDef="let item"> {{item.phone}} </td>
          </ng-container>
          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef> Role</th>
            <td mat-cell *matCellDef="let item"> {{item.role}} </td>
          </ng-container>
          <ng-container matColumnDef="is_active">
            <th mat-header-cell *matHeaderCellDef> Status</th>
            <td mat-cell *matCellDef="let item"> {{(item.is_active) ? 'Active' : 'Inactive'}} </td>
          </ng-container>
          <ng-container matColumnDef="updated_at">
            <th mat-header-cell *matHeaderCellDef> Updated</th>
            <td mat-cell *matCellDef="let item"> {{item.updated_at | amTimeAgo }} </td>
          </ng-container>
          <ng-container matColumnDef="actions" stickyEnd>
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let item" class="min-width-cell">
              <div *ngIf="_common._mobileQuery.matches">
                <button mat-icon-button [matMenuTriggerFor]="menu">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button *ngFor="let action of userList.actionButtons" mat-menu-item
                          (click)="_runInAngular(action.callback, item)">
                    <mat-icon color="{{action.color}}">{{action.icon}}</mat-icon>
                    {{action.text | titlecase}}</button>
                </mat-menu>
              </div>

              <div *ngIf="!_common._mobileQuery.matches">
                <button *ngFor="let action of userList.actionButtons" [matTooltip]="action.text"
                        (click)="_runInAngular(action.callback, item)" mat-icon-button color="{{action.color}}">
                  <mat-icon>{{action.icon}}</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="userList.matColumns; sticky: true;"></tr>
          <tr mat-row *matRowDef="let item; columns: userList.matColumns;"></tr>
        </table>
      </div>
      <div class="ts-clearfix">&nbsp;</div>

      <ts-mat-pagination [pagination]="userList.pagination"
                         (goToPage)="userList.pageEvent($event)"></ts-mat-pagination>

      <ts-no-data-card [canShow]="userList.canShowNoData()"></ts-no-data-card>
    </div>
  </mat-card-content>
</mat-card>

<div class="add-action-button bottom-right">
  <button mat-flat-button color="primary" class="rounded" (click)="openAddEditItem()">
    <mat-icon>add</mat-icon>
  </button>
</div>


<ng-template #actionItemAddTemplate>
  <h1 mat-dialog-title>Add User</h1>
  <form name="userForm" [formGroup]="actionItemAddForm" class="form-spacing">
    <div mat-dialog-content>

      <mat-form-field appearance="outline" class="input-block">
        <mat-label>First Name</mat-label>
        <input name="first_name" matInput type="text" placeholder="enter first name" formControlName="first_name"
               required/>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.first_name?.errors"
                                  [messages]="{required: 'First name is required'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="input-block">
        <mat-label>Last Name</mat-label>
        <input name="last_name" matInput type="text" placeholder="enter last name" formControlName="last_name"
               required/>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.last_name?.errors"
                                  [messages]="{required: 'Last name is required'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="input-block">
        <mat-label>Email</mat-label>
        <input name="email" matInput type="text" placeholder="enter email" formControlName="email" required/>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.email?.errors"
                                  [messages]="{required: 'Email is required'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="input-block">
        <mat-label>Phone</mat-label>
        <input name="phone" matInput type="text" placeholder="enter phone" formControlName="phone" required/>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.phone?.errors"
                                  [messages]="{required: 'Phone is required', pattern: 'Invalid mobile number'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="input-block">
        <mat-label>Password</mat-label>
        <input name="password" matInput type="password" placeholder="enter password" formControlName="password"
               required/>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.password?.errors"
                                  [messages]="{required: 'Password is required'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="input-block">
        <mat-label>Role</mat-label>
        <mat-select name="role" formControlName="role" required>
          <mat-option value='user'>User</mat-option>
          <mat-option value='incharge'>Incharge</mat-option>
          <mat-option value='principal'>Principal</mat-option>
        </mat-select>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.role?.errors"
                                  [messages]="{required: 'Role is required'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>

    </div>
    <div mat-dialog-actions align='end'>
      <button mat-flat-button [mat-dialog-close]>Cancel</button>
      <button mat-flat-button [disabled]="actionItemAddForm.invalid || disableActionButtons"
              [class.has-loading-spinner]="disableActionButtons" (click)="itemAdd()" color="primary">
        <mat-spinner diameter="20" class="input-loading-spinner" *ngIf="disableActionButtons"></mat-spinner>
        Add
      </button>
    </div>
  </form>
</ng-template>

<ng-template #actionItemEditTemplate>
  <h1 mat-dialog-title>Edit User</h1>
  <form name="userFormEdit" [formGroup]="actionItemEditForm" class="form-spacing">
    <div mat-dialog-content>

      <mat-form-field appearance="outline" class="input-block">
        <mat-label>First Name</mat-label>
        <input name="first_name" matInput type="text" placeholder="enter first name" formControlName="first_name"
               required/>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.first_name?.errors"
                                  [messages]="{required: 'First name is required'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="input-block">
        <mat-label>Last Name</mat-label>
        <input name="last_name" matInput type="text" placeholder="enter last name" formControlName="last_name"
               required/>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.last_name?.errors"
                                  [messages]="{required: 'Last name is required'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="input-block">
        <mat-label>Email</mat-label>
        <input name="email" matInput type="text" placeholder="enter email" formControlName="email" required/>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.email?.errors"
                                  [messages]="{required: 'Email is required'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="input-block">
        <mat-label>Phone</mat-label>
        <input name="phone" matInput type="text" placeholder="enter phone" formControlName="phone" required/>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.phone?.errors"
                                  [messages]="{required: 'Phone is required', pattern: 'Invalid mobile number'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="input-block">
        <mat-label>Role</mat-label>
        <mat-select name="role" formControlName="role" required>
          <mat-option value='user'>User</mat-option>
          <mat-option value='incharge'>Incharge</mat-option>
          <mat-option value='principal'>Principal</mat-option>
        </mat-select>
        <mat-error>
          <ts-display-form-errors [errors]="actionItemAddForm?.controls.role?.errors"
                                  [messages]="{required: 'Role is required'}"
          ></ts-display-form-errors>
        </mat-error>
      </mat-form-field>

    </div>
    <div mat-dialog-actions align='end'>
      <button mat-flat-button [mat-dialog-close]>Cancel</button>
      <button mat-flat-button [disabled]="actionItemEditForm.invalid || disableActionButtons" (click)="itemEdit()"
              color="primary" [class.has-loading-spinner]="disableActionButtons">
        <mat-spinner diameter="20" class="input-loading-spinner" *ngIf="disableActionButtons"></mat-spinner>
        Update
      </button>
    </div>
  </form>
</ng-template>
